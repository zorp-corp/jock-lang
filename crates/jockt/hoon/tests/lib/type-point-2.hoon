::  /lib/tests/type-point-2
/+  jock,
    test
/*  hoon  %txt  /lib/mini/txt
::
|%
++  text
  'compose\0a  class Point(x:Uint y:Uint) {\0a   add(p:(x:Uint y:Uint)) -> Point {\0a     (x + p.x\0a      y + p.y)\0a   }\0a   sub(p:(x:Uint y:Uint)) -> Point {\0a     (x - p.x\0a      y - p.y)\0a   }\0a  }\0a;\0a\0alet point-1 = Point(104 124);\0apoint-1 = point-1.add(38 38);\0alet point-2 = Point(30 40);\0a//&2\0apoint-2 = point-2.add(212 302);\0a//&1\0apoint-1 = point-1.sub(100 20);\0a//&1\0a( (point-1.x() point-1.y())\0a  (point-2.x() point-2.y())\0a)/**/\0a\0a/*\0a::  Hoon equivalent program\0a!=\0a=>  mini=mini\0a=>\0a  ^=  door\0a  |_  [x=@ y=@]\0a  ++  add\0a    |=  p=[x=@ y=@]\0a    ~(. +> [(add:mini x x.p) (add:mini y y.p)])\0a  ++  sub\0a    |=  p=[x=@ y=@]\0a    ~(. +> [(sub:mini x x.p) (sub:mini y y.p)])\0a  --\0a=/  point-1\0a  ~(. door [104 124])\0a=.  point-1  (add:point-1 [38 38])\0a=/  point-2\0a  ~(. door [30 40])\0a=.  point-1  (sub:point-1 [100 20])\0a=.  point-2  (add:point-2 [212 302])\0a[[+12 +13]:point-1 [+12 +13]:point-2]\0a\0aJock:\0a[7 [0 2]\0a 7 [8 [[1 0] 1 0]\0a      [1 [8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1]\0a          8 [[1 0] 1 0] [1 [8 [9 3.061 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 3.061 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1] 0 1]\0a 8 [8 [0 1] 10 [6 7 [0 3] [1 104] 1 124] 0 2]\0a 7 [10 [2 8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] [1 38] 1 38] 0 2] 0 1]\0a 8 [8 [0 3] 10 [6 7 [0 3] [1 30] 1 40] 0 2]\0a 7 [10 [2 8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] [1 212] 1 302] 0 2] 0 1]\0a 7 [10 [6 8 [7 [0 6] 9 5 0 1] 9 2 10 [6 7 [0 3] [1 100] 1 20] 0 2] 0 1]\0a [[7 [0 6] 7 [0 6] 0 2] 7 [0 6] 7 [0 6] 0 3]\0a  [7 [0 2] 7 [0 6] 0 2] 7 [0 2] 7 [0 6] 0 3]\0a\0aHoon:\0a[ 7 [0 4]\0a  7 [8 [1 0 0]\0a       [1 [8 [1 0 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [7 [0 31] 9 348 0 1] 9 2 10 [6 [0 124] 0 28] 0 2] 8 [7 [0 31] 9 348 0 1] 9 2 10 [6 [0 125] 0 29] 0 2] 0 2] 0 1]\0a           8 [1 0 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [7 [0 31] 9 3.061 0 1] 9 2 10 [6 [0 124] 0 28] 0 2] 8 [7 [0 31] 9 3.061 0 1] 9 2 10 [6 [0 125] 0 29] 0 2] 0 2] 0 1] 0 1]\0a  8 [8 [0 1] 10 [6 7 [0 3] 1 104 124] 0 2]\0a  7 [10 [2 8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] 1 38 38] 0 2] 0 1]\0a* 8 [8 [0 3] 10 [6 7 [0 3] 1 30 40] 0 2]\0a  7 [10 [2 8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] 1 212 302] 0 2] 0 1]\0a  7 [10 [6 8 [7 [0 6] 9 5 0 1] 9 2 10 [6 7 [0 3] 1 100 20] 0 2] 0 1]\0a  [7 [0 6] [0 12] 0 13]\0a  7 [0 2] [0 12] 0 13]\0a*/\0a'
++  test-tokenize
  %+  expect-eq:test
    !>  ~[[%keyword %compose] [%keyword %class] [%type 'Point'] [%punctuator %'(('] [%name %x] [%punctuator %':'] [%type 'Uint'] [%name %y] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %'{'] [%name %add] [%punctuator %'(('] [%name %p] [%punctuator %':'] [%punctuator %'('] [%name %x] [%punctuator %':'] [%type 'Uint'] [%name %y] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %')'] [%punctuator %'-'] [%punctuator %'>'] [%type 'Point'] [%punctuator %'{'] [%punctuator %'('] [%name %x] [%punctuator %'+'] [%name %p] [%punctuator %'.'] [%name %x] [%name %y] [%punctuator %'+'] [%name %p] [%punctuator %'.'] [%name %y] [%punctuator %')'] [%punctuator %'}'] [%name %sub] [%punctuator %'(('] [%name %p] [%punctuator %':'] [%punctuator %'('] [%name %x] [%punctuator %':'] [%type 'Uint'] [%name %y] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %')'] [%punctuator %'-'] [%punctuator %'>'] [%type 'Point'] [%punctuator %'{'] [%punctuator %'('] [%name %x] [%punctuator %'-'] [%name %p] [%punctuator %'.'] [%name %x] [%name %y] [%punctuator %'-'] [%name %p] [%punctuator %'.'] [%name %y] [%punctuator %')'] [%punctuator %'}'] [%punctuator %'}'] [%punctuator %';'] [%keyword %let] [%name %point-1] [%punctuator %'='] [%type 'Point'] [%punctuator %'(('] [%literal [[%number p=104] q=%.n]] [%literal [[%number p=124] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%name %point-1] [%punctuator %'='] [%name %point-1] [%punctuator %'.'] [%name %add] [%punctuator %'(('] [%literal [[%number p=38] q=%.n]] [%literal [[%number p=38] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%keyword %let] [%name %point-2] [%punctuator %'='] [%type 'Point'] [%punctuator %'(('] [%literal [[%number p=30] q=%.n]] [%literal [[%number p=40] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%name %point-2] [%punctuator %'='] [%name %point-2] [%punctuator %'.'] [%name %add] [%punctuator %'(('] [%literal [[%number p=212] q=%.n]] [%literal [[%number p=302] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%name %point-1] [%punctuator %'='] [%name %point-1] [%punctuator %'.'] [%name %sub] [%punctuator %'(('] [%literal [[%number p=100] q=%.n]] [%literal [[%number p=20] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%punctuator %'('] [%punctuator %'('] [%name %point-1] [%punctuator %'.'] [%name %x] [%punctuator %'(('] [%punctuator %')'] [%name %point-1] [%punctuator %'.'] [%name %y] [%punctuator %'(('] [%punctuator %')'] [%punctuator %')'] [%punctuator %'('] [%name %point-2] [%punctuator %'.'] [%name %x] [%punctuator %'(('] [%punctuator %')'] [%name %point-2] [%punctuator %'.'] [%name %y] [%punctuator %'(('] [%punctuator %')'] [%punctuator %')'] [%punctuator %')']]
    !>  (rash text parse-tokens:jock)
::
++  test-jeam
  %+  expect-eq:test
    !>  ^-  jock:jock
        [%compose p=[%class state=[p=[%state p=[[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='']] name='Point'] arms=[n=[p=%add q=[%method type=[p=[%core p=[%.y p=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[p=[%limb p=~[[%type p='Point']]] name='Point']]] q=~] name='add'] body=[%lambda p=[arg=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[p=[%limb p=~[[%type p='Point']]] name='Point']] body=[p=[%operator op=%'+' a=[%limb p=~[[%name p=%x]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%x]]]]] q=[%operator op=%'+' a=[%limb p=~[[%name p=%y]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%y]]]]]] context=~]]]] l=~ r=[n=[p=%sub q=[%method type=[p=[%core p=[%.y p=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[p=[%limb p=~[[%type p='Point']]] name='Point']]] q=~] name='sub'] body=[%lambda p=[arg=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[p=[%limb p=~[[%type p='Point']]] name='Point']] body=[p=[%operator op=%'-' a=[%limb p=~[[%name p=%x]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%x]]]]] q=[%operator op=%'-' a=[%limb p=~[[%name p=%y]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%y]]]]]] context=~]]]] l=~ r=~]]] q=[%let type=[p=[%none p=~] name='point-1'] val=[%call func=[%limb p=~[[%type p='Point']]] arg=[~ [p=[%atom p=[[%number p=104] q=%.n]] q=[%atom p=[[%number p=124] q=%.n]]]]] next=[%edit limb=~[[%name p=%point-1]] val=[%call func=[%limb p=~[[%name p=%point-1] [%name p=%add]]] arg=[~ [p=[%atom p=[[%number p=38] q=%.n]] q=[%atom p=[[%number p=38] q=%.n]]]]] next=[%let type=[p=[%none p=~] name='point-2'] val=[%call func=[%limb p=~[[%type p='Point']]] arg=[~ [p=[%atom p=[[%number p=30] q=%.n]] q=[%atom p=[[%number p=40] q=%.n]]]]] next=[%edit limb=~[[%name p=%point-2]] val=[%call func=[%limb p=~[[%name p=%point-2] [%name p=%add]]] arg=[~ [p=[%atom p=[[%number p=212] q=%.n]] q=[%atom p=[[%number p=302] q=%.n]]]]] next=[%edit limb=~[[%name p=%point-1]] val=[%call func=[%limb p=~[[%name p=%point-1] [%name p=%sub]]] arg=[~ [p=[%atom p=[[%number p=100] q=%.n]] q=[%atom p=[[%number p=20] q=%.n]]]]] next=[p=[p=[%call func=[%limb p=~[[%name p=%point-1] [%name p=%x]]] arg=~] q=[%call func=[%limb p=~[[%name p=%point-1] [%name p=%y]]] arg=~]] q=[p=[%call func=[%limb p=~[[%name p=%point-2] [%name p=%x]]] arg=~] q=[%call func=[%limb p=~[[%name p=%point-2] [%name p=%y]]] arg=~]]]]]]]]]
    !>  (jeam:jock text)
::
++  test-mint
  %+  expect-eq:test
    !>  [%7 p=[%8 p=[p=[%1 p=0] q=[%1 p=0]] q=[p=[%1 p=[[8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1] 8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 3.061 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 3.061 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1]] q=[%0 p=1]]] q=[%8 p=[%8 p=[%0 p=1] q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=104] q=[%1 p=124]]]] q=[%0 p=2]]] q=[%7 p=[%10 p=[p=2 q=[%8 p=[%7 p=[%0 p=2] q=[%9 p=4 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=38] q=[%1 p=38]]]] q=[%0 p=2]]]]] q=[%0 p=1]] q=[%8 p=[%8 p=[%0 p=3] q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=30] q=[%1 p=40]]]] q=[%0 p=2]]] q=[%7 p=[%10 p=[p=2 q=[%8 p=[%7 p=[%0 p=2] q=[%9 p=4 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=212] q=[%1 p=302]]]] q=[%0 p=2]]]]] q=[%0 p=1]] q=[%7 p=[%10 p=[p=6 q=[%8 p=[%7 p=[%0 p=6] q=[%9 p=5 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=100] q=[%1 p=20]]]] q=[%0 p=2]]]]] q=[%0 p=1]] q=[p=[p=[%7 p=[%0 p=6] q=[%7 p=[%0 p=6] q=[%0 p=2]]] q=[%7 p=[%0 p=6] q=[%7 p=[%0 p=6] q=[%0 p=3]]]] q=[p=[%7 p=[%0 p=2] q=[%7 p=[%0 p=6] q=[%0 p=2]]] q=[%7 p=[%0 p=2] q=[%7 p=[%0 p=6] q=[%0 p=3]]]]]]]]]]]
    !>  +>:(mint:jock text)
::
++  test-nock
  =/  past  (rush q.hoon (ifix [gay gay] tall:(vang | /)))
  ?~  past  ~|("unable to parse Hoon library" !!)
  =/  p  (~(mint ut %noun) %noun u.past)
  %+  expect-eq:test
    !>  .*  0
        :+  %8
          +.p
        [%7 p=[%8 p=[p=[%1 p=0] q=[%1 p=0]] q=[p=[%1 p=[[8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1] 8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 3.061 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 3.061 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1]] q=[%0 p=1]]] q=[%8 p=[%8 p=[%0 p=1] q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=104] q=[%1 p=124]]]] q=[%0 p=2]]] q=[%7 p=[%10 p=[p=2 q=[%8 p=[%7 p=[%0 p=2] q=[%9 p=4 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=38] q=[%1 p=38]]]] q=[%0 p=2]]]]] q=[%0 p=1]] q=[%8 p=[%8 p=[%0 p=3] q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=30] q=[%1 p=40]]]] q=[%0 p=2]]] q=[%7 p=[%10 p=[p=2 q=[%8 p=[%7 p=[%0 p=2] q=[%9 p=4 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=212] q=[%1 p=302]]]] q=[%0 p=2]]]]] q=[%0 p=1]] q=[%7 p=[%10 p=[p=6 q=[%8 p=[%7 p=[%0 p=6] q=[%9 p=5 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=100] q=[%1 p=20]]]] q=[%0 p=2]]]]] q=[%0 p=1]] q=[p=[p=[%7 p=[%0 p=6] q=[%7 p=[%0 p=6] q=[%0 p=2]]] q=[%7 p=[%0 p=6] q=[%7 p=[%0 p=6] q=[%0 p=3]]]] q=[p=[%7 p=[%0 p=2] q=[%7 p=[%0 p=6] q=[%0 p=2]]] q=[%7 p=[%0 p=2] q=[%7 p=[%0 p=6] q=[%0 p=3]]]]]]]]]]]
    !>  .*(0 (mint:jock text))
::
--
