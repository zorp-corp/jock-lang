::  /lib/tests/type-point-3
/+  jock,
    test
/*  hoon  %txt  /lib/mini/txt
::
|%
++  text
  'compose\0a  class Point(x:Uint y:Uint) {\0a    add(p:(x:Uint y:Uint)) -> Point {\0a      (x + p.x\0a       y + p.y)\0a    }\0a    add_cell(p:(x:Uint y:Uint)) -> (Uint Uint) {\0a      (x + p.x\0a       y + p.y)\0a    }\0a    inc(q:Uint) -> @ {\0a      +(q)\0a    }\0a  }\0a;\0a\0alet one = Point(2 13);\0alet two = one.add(30 19);\0alet three = one.inc(41);\0a(two.add_cell(10 10) three)\0a\0a/*\0a::  Hoon equivalent program\0a!=\0a=>  mini=mini\0a=>\0a  ^=  door\0a  |_  [x=@ y=@]\0a  ++  add\0a    |=  p=[x=@ y=@]\0a    ~(. +> [(add:mini x x.p) (add:mini y y.p)])\0a  ++  add_cell\0a    |=  p=[x=@ y=@]\0a    [(add:mini x x.p) (add:mini y y.p)]\0a  ++  inc\0a    |=  q=@\0a    +(q)\0a  --\0a=/  one\0a  ~(. door [2 13])\0a=/  two  (add:one [30 19])\0a=/  three  (inc:one 41)\0a[(add_cell:two [10 10]) three]\0a\0a<<<<<<< HEAD\0aJock:\0a[7 [8 [[1 0] 1 0] [1 [8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1] [8 [1 0] [1 4 0 6] 0 1] 8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1] 0 1] 8 [8 [0 1] 10 [6 7 [0 3] [1 2] 1 13] 0 2] 8 [8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] [1 30] 1 19] 0 2] 8 [8 [7 [0 6] 9 10 0 1] 9 2 10 [6 7 [0 3] 1 41] 0 2] [8 [7 [0 6] 9 11 0 1] 9 2 10 [6 7 [0 3] [1 10] 1 10] 0 2] 0 2]\0a\0aHoon:\0a=======\0aH:\0a>>>>>>> sigilante/itll-cost-you-an-arm-and-a-leg\0a[ 7\0a  [0 2]\0a  7\0a  [ 8\0a    [1 0 0]\0a    [ 1\0a      [8 [1 0 0] [1 [8 [7 [0 31] 9 348 0 1] 9 2 10 [6 [0 124] 0 28] 0 2] 8 [7 [0 31] 9 348 0 1] 9 2 10 [6 [0 125] 0 29] 0 2] 0 1]\0a      [8 [1 0 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [7 [0 31] 9 348 0 1] 9 2 10 [6 [0 124] 0 28] 0 2] 8 [7 [0 31] 9 348 0 1] 9 2 10 [6 [0 125] 0 29] 0 2] 0 2] 0 1]\0a       8 [1 0] [1 4 0 6] 0 1]\0a<<<<<<< HEAD\0a     0 1]\0a  8 [8 [0 1] 10 [6 7 [0 3] 1 2 13] 0 2] 8\0a  [8 [7 [0 2] 9 10 0 1] 9 2 10 [6 7 [0 3] 1 30 19] 0 2]\0a  8 [8 [7 [0 6] 9 11 0 1] 9 2 10 [6 7 [0 3] 1 41] 0 2]\0a  [8 [7 [0 6] 9 4 0 1] 9 2 10 [6 7 [0 3] 1 10 10] 0 2] 0 2]\0a=======\0a    0 1]\0a  8 [8 [0 1] 10 [6 7 [0 3] 1 2 13] 0 2]\0a  8 [8 [7 [0 2] 9 10 0 1] 9 2 10 [6 7 [0 3] 1 30 19] 0 2]\0a  8 [8 [7 [0 6] 9 11 0 1] 9 2 10 [6 7 [0 3] 1 41] 0 2]\0a  [8 [7 [0 6] 9 4 0 1] 9 2 10 [6 7 [0 3] 1 10 10] 0 2] 0 2]\0a\0aJ:\0a[7\0a  [8 [[1 0] 1 0]\0a     [1 [8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1]\0a        [8 [1 0] [1 4 0 6] 0 1]\0a         8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1]\0a     0 1]\0a   8 [8 [0 1] 10 [6 7 [0 3] [1 2] 1 13] 0 2]\0a   8 [8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] [1 30] 1 19] 0 2]\0a   8 [8 [7 [0 6] 9 10 0 1] 9 2 10 [6 7 [0 3] 1 41] 0 2]\0a   [8 [7 [0 6] 9 11 0 1] 9 2 10 [6 7 [0 3] [1 10] 1 10] 0 2] 0 2]\0a\0a7 [8 [[1 0] 1 0] [1 [8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1] [8 [1 0] [1 4 0 6] 0 1] 8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1] 0 1] 8 [8 [0 1] 10 [6 7 [0 3] [1 2] 1 13] 0 2] 8 [8 [7 [0 2] 9 4 0 1] 9 2 10 [6 7 [0 3] [1 30] 1 19] 0 2] 8 [8 [7 [0 6] 9 10 0 1] 9 2 10 [6 7 [0 3] 1 41] 0 2] [8 [7 [0 6] 9 11 0 1] 9 2 10 [6 7 [0 3] [1 10] 1 10] 0 2] 0 2]]\0a>>>>>>> sigilante/itll-cost-you-an-arm-and-a-leg\0a*/\0a'
:: ++  test-tokenize
  :: %+  expect-eq:test
    :: !>  ~[[%keyword %compose] [%keyword %class] [%type 'Point'] [%punctuator %'(('] [%name %x] [%punctuator %':'] [%type 'Uint'] [%name %y] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %'{'] [%name %add] [%punctuator %'(('] [%name %p] [%punctuator %':'] [%punctuator %'('] [%name %x] [%punctuator %':'] [%type 'Uint'] [%name %y] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %')'] [%punctuator %'-'] [%punctuator %'>'] [%type 'Point'] [%punctuator %'{'] [%punctuator %'('] [%name %x] [%punctuator %'+'] [%name %p] [%punctuator %'.'] [%name %x] [%name %y] [%punctuator %'+'] [%name %p] [%punctuator %'.'] [%name %y] [%punctuator %')'] [%punctuator %'}'] [%name %add_cell] [%punctuator %'(('] [%name %p] [%punctuator %':'] [%punctuator %'('] [%name %x] [%punctuator %':'] [%type 'Uint'] [%name %y] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %')'] [%punctuator %'-'] [%punctuator %'>'] [%punctuator %'('] [%type 'Uint'] [%type 'Uint'] [%punctuator %')'] [%punctuator %'{'] [%punctuator %'('] [%name %x] [%punctuator %'+'] [%name %p] [%punctuator %'.'] [%name %x] [%name %y] [%punctuator %'+'] [%name %p] [%punctuator %'.'] [%name %y] [%punctuator %')'] [%punctuator %'}'] [%name %inc] [%punctuator %'(('] [%name %q] [%punctuator %':'] [%type 'Uint'] [%punctuator %')'] [%punctuator %'-'] [%punctuator %'>'] [%punctuator %'@'] [%punctuator %'{'] [%punctuator %'+'] [%punctuator %'('] [%name %q] [%punctuator %')'] [%punctuator %'}'] [%punctuator %'}'] [%punctuator %';'] [%keyword %let] [%name %one] [%punctuator %'='] [%type 'Point'] [%punctuator %'(('] [%literal [[%number p=2] q=%.n]] [%literal [[%number p=13] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%keyword %let] [%name %two] [%punctuator %'='] [%name %one] [%punctuator %'.'] [%name %add] [%punctuator %'(('] [%literal [[%number p=30] q=%.n]] [%literal [[%number p=19] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%keyword %let] [%name %three] [%punctuator %'='] [%name %one] [%punctuator %'.'] [%name %inc] [%punctuator %'(('] [%literal [[%number p=41] q=%.n]] [%punctuator %')'] [%punctuator %';'] [%punctuator %'('] [%name %two] [%punctuator %'.'] [%name %add_cell] [%punctuator %'(('] [%literal [[%number p=10] q=%.n]] [%literal [[%number p=10] q=%.n]] [%punctuator %')'] [%name %three] [%punctuator %')']]
    :: !>  (rash text parse-tokens:jock)
::
:: ++  test-jeam
  :: %+  expect-eq:test
    :: !>  ^-  jock:jock
        :: [%compose p=[%class state=[p=[%state p=[[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='']] name='Point'] arms=[n=[p=%add_cell q=[%method type=[p=[%core p=[%.y p=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[[p=[p=[%atom p=%number q=%.n] name='Uint'] q=[p=[%atom p=%number q=%.n] name='Uint']] name='']]] q=~] name='add_cell'] body=[%lambda p=[arg=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[[p=[p=[%atom p=%number q=%.n] name='Uint'] q=[p=[%atom p=%number q=%.n] name='Uint']] name='']] body=[p=[%operator op=%'+' a=[%limb p=~[[%name p=%x]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%x]]]]] q=[%operator op=%'+' a=[%limb p=~[[%name p=%y]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%y]]]]]] context=~]]]] l=[n=[p=%add q=[%method type=[p=[%core p=[%.y p=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[p=[%limb p=~[[%type p='Point']]] name='Point']]] q=~] name='add'] body=[%lambda p=[arg=[inp=[~ [[p=[p=[%atom p=%number q=%.n] name='x'] q=[p=[%atom p=%number q=%.n] name='y']] name='p']] out=[p=[%limb p=~[[%type p='Point']]] name='Point']] body=[p=[%operator op=%'+' a=[%limb p=~[[%name p=%x]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%x]]]]] q=[%operator op=%'+' a=[%limb p=~[[%name p=%y]]] b=[~ [%limb p=~[[%name p=%p] [%name p=%y]]]]]] context=~]]]] l=~ r={[p=%inc q=[%method type=[p=[%core p=[%.y p=[inp=[~ [p=[%atom p=%number q=%.n] name='q']] out=[p=[%atom p=%number q=%.n] name='']]] q=~] name='inc'] body=[%lambda p=[arg=[inp=[~ [p=[%atom p=%number q=%.n] name='q']] out=[p=[%atom p=%number q=%.n] name='']] body=[%increment val=[%limb p=~[[%name p=%q]]]] context=~]]]]}] r=~]] q=[%let type=[p=[%none p=~] name='one'] val=[%call func=[%limb p=~[[%type p='Point']]] arg=[~ [p=[%atom p=[[%number p=2] q=%.n]] q=[%atom p=[[%number p=13] q=%.n]]]]] next=[%let type=[p=[%none p=~] name='two'] val=[%call func=[%limb p=~[[%name p=%one] [%name p=%add]]] arg=[~ [p=[%atom p=[[%number p=30] q=%.n]] q=[%atom p=[[%number p=19] q=%.n]]]]] next=[%let type=[p=[%none p=~] name='three'] val=[%call func=[%limb p=~[[%name p=%one] [%name p=%inc]]] arg=[~ [%atom p=[[%number p=41] q=%.n]]]] next=[p=[%call func=[%limb p=~[[%name p=%two] [%name p=%add_cell]]] arg=[~ [p=[%atom p=[[%number p=10] q=%.n]] q=[%atom p=[[%number p=10] q=%.n]]]]] q=[%limb p=~[[%name p=%three]]]]]]]]
    :: !>  (jeam:jock text)
::
++  test-mint
  %+  expect-eq:test
    !>  [%7 p=[%8 p=[p=[%1 p=0] q=[%1 p=0]] q=[p=[%1 p=[[8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1] [8 [1 0] [1 4 0 6] 0 1] 8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1]] q=[%0 p=1]]] q=[%8 p=[%8 p=[%0 p=1] q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=2] q=[%1 p=13]]]] q=[%0 p=2]]] q=[%8 p=[%8 p=[%7 p=[%0 p=2] q=[%9 p=4 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=30] q=[%1 p=19]]]] q=[%0 p=2]]]] q=[%8 p=[%8 p=[%7 p=[%0 p=6] q=[%9 p=10 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[%1 p=41]]] q=[%0 p=2]]]] q=[p=[%8 p=[%7 p=[%0 p=6] q=[%9 p=11 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=10] q=[%1 p=10]]]] q=[%0 p=2]]]] q=[%0 p=2]]]]]]
    !>  +>:(mint:jock text)
::
++  test-nock
  =/  past  (rush q.hoon (ifix [gay gay] tall:(vang | /)))
  ?~  past  ~|("unable to parse Hoon library" !!)
  =/  p  (~(mint ut %noun) %noun u.past)
  %+  expect-eq:test
    !>  .*  0
        :+  %8
          +.p
        [%7 p=[%8 p=[p=[%1 p=0] q=[%1 p=0]] q=[p=[%1 p=[[8 [[1 0] 1 0] [1 8 [0 7] 10 [6 7 [0 3] [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 2] 0 1] [8 [1 0] [1 4 0 6] 0 1] 8 [[1 0] 1 0] [1 [8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 60] 0 12] 0 2] 8 [9 348 0 62] 9 2 10 [6 7 [0 3] [0 61] 0 13] 0 2] 0 1]] q=[%0 p=1]]] q=[%8 p=[%8 p=[%0 p=1] q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=2] q=[%1 p=13]]]] q=[%0 p=2]]] q=[%8 p=[%8 p=[%7 p=[%0 p=2] q=[%9 p=4 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=30] q=[%1 p=19]]]] q=[%0 p=2]]]] q=[%8 p=[%8 p=[%7 p=[%0 p=6] q=[%9 p=10 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[%1 p=41]]] q=[%0 p=2]]]] q=[p=[%8 p=[%7 p=[%0 p=6] q=[%9 p=11 q=[%0 p=1]]] q=[%9 p=2 q=[%10 p=[p=6 q=[%7 p=[%0 p=3] q=[p=[%1 p=10] q=[%1 p=10]]]] q=[%0 p=2]]]] q=[%0 p=2]]]]]]
    !>  .*(0 (mint:jock text))
::
--
